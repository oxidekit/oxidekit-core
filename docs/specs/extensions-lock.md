# extensions.lock Specification

**Version:** 0.1.0
**Status:** Draft

## Overview

`extensions.lock` is an auto-generated lock file that ensures reproducible builds by pinning exact extension versions and their checksums.

## Location

The lock file is located at the project root alongside `oxide.toml`:

```
my-app/
├── oxide.toml
├── extensions.lock    # Auto-generated
├── src/
└── ui/
```

## Purpose

1. **Reproducibility** - Same dependencies across all builds
2. **Security** - Verify extension integrity via checksums
3. **Speed** - Skip resolution when lock file is current

## Schema

```toml
# Auto-generated by oxide - do not edit manually
# Run `oxide update` to regenerate

version = 1

[[package]]
id = "ui.tables"
version = "0.3.1"
source = "registry"
checksum = "sha256:abc123def456..."
dependencies = []

[[package]]
id = "theme.wallet.dark"
version = "1.2.0"
source = "registry"
checksum = "sha256:def456ghi789..."
dependencies = ["ui.base"]

[[package]]
id = "ui.base"
version = "0.2.0"
source = "registry"
checksum = "sha256:789xyz..."
dependencies = []

[[package]]
id = "native.filesystem"
version = "0.1.0"
source = "registry"
checksum = "sha256:ghi012jkl345..."
dependencies = []
capabilities = ["filesystem.read", "filesystem.write"]
```

## Fields

### Root

| Field | Required | Type | Description |
|-------|----------|------|-------------|
| `version` | Yes | u32 | Lock file format version |

### `[[package]]` - Package Entry

| Field | Required | Type | Description |
|-------|----------|------|-------------|
| `id` | Yes | String | Package identifier |
| `version` | Yes | String | Exact resolved version |
| `source` | Yes | String | Package source |
| `checksum` | Yes | String | SHA-256 hash of package |
| `dependencies` | No | Array | Dependency package IDs |
| `capabilities` | No | Array | Required capabilities |

### Source Types

| Source | Description | Example |
|--------|-------------|---------|
| `registry` | Official OxideKit registry | Default |
| `git` | Git repository | `git+https://github.com/...` |
| `path` | Local path (dev only) | `path+../my-extension` |

## Checksum Format

Checksums use the format: `algorithm:hex_digest`

```
sha256:abc123def456789...
```

Currently only SHA-256 is supported.

## Generation

The lock file is generated/updated by:

```bash
# Add a new extension (updates lock)
oxide add ui.tables

# Update all extensions to latest
oxide update

# Update specific extension
oxide update ui.tables

# Regenerate lock from scratch
oxide update --force
```

## Verification

On every build, OxideKit verifies:

1. All packages in `oxide.toml` are in lock file
2. Checksums match downloaded packages
3. Version constraints are satisfied

If verification fails:
- `oxide build` exits with error
- User must run `oxide update` to fix

## Version Control

**Commit `extensions.lock`** to version control. This ensures:
- All team members use identical extensions
- CI/CD builds are reproducible
- Auditing shows exactly what was deployed

## Example: Empty Project

```toml
# Auto-generated by oxide - do not edit manually
version = 1
```

## Example: With Dependencies

```toml
# Auto-generated by oxide - do not edit manually
# Generated: 2025-01-15T10:30:00Z
# oxide-cli: 0.1.0

version = 1

[[package]]
id = "ui.base"
version = "0.2.0"
source = "registry"
checksum = "sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"

[[package]]
id = "ui.tables"
version = "0.3.1"
source = "registry"
checksum = "sha256:a948904f2f0f479b8f8564cbf12dace4e2e1d8ef2c4c9d8b1c0f5e6d7a8b9c0d1"
dependencies = ["ui.base"]

[[package]]
id = "theme.wallet.dark"
version = "1.2.0"
source = "registry"
checksum = "sha256:b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2"
dependencies = ["ui.base"]
```
